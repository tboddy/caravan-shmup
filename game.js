const fps = 60, canvas = document.getElementById('canvas'), canvasEl = $('canvas'), grid = 16, gameHeight = 240, gameWidth = 256, browserWindow = require('electron').remote, storage = require('electron-json-storage'),
charImg = new Image(), analogThresh = 0.15;
const context = canvas.getContext('2d'), mainWindow = browserWindow.getCurrentWindow();
let gamepad = false, savedData = {}, startedGame = false, isFullscreen = false, loop, canGetHit = true;
charImg.src = 'img/font.png';

const resizeGame = function(){
	var canvasWidth = getAspect().width, canvasHeight = getAspect().height;
	canvasEl.css('width', canvasWidth + 'px').css('height', canvasHeight + 'px').css('margin-left', -(canvasWidth / 2) + 'px').css('margin-top', -(canvasHeight / 2) + 'px');
},

degToRad = function(d) {
	return d * 0.0174532925199432957;
},

clearGame = function(){
	resizeGame();
	context.clearRect(0, 0, getAspect().width, getAspect().height);
},

getAspect = function(){
	var newWidth = $(window).width(), newHeight = $(window).height(), remHeight = $(window).width() * 0.9375, remWidth = $(window).height() * 1.066666666667;
	if(newWidth >= remWidth) newWidth = remWidth;
	else if(newHeight > remHeight) newHeight = remHeight;
	return {width: newWidth, height: newHeight};
},

drawString = function(input, x, y, isRed){
	input.split('').forEach(function(char, i){
		drawChar(char, x + (i * (grid / 2)), y, isRed);
	});
},

drawChar = function(input, x, y, isRed){
	let charLeft = 0, charTop = 0;
	const size = grid / 2;

	switch(input){
		// case '0': charLeft = numStart; break;
		case '1': charLeft = size; break;
		case '2': charLeft = size * 2; break;
		case '3': charLeft = size * 3; break;
		case '4': charLeft = size * 4; break;
		case '5': charLeft = size * 5; break;
		case '6': charLeft = size * 6; break;
		case '7': charLeft = size * 7; break;
		case '8': charLeft = size * 8; break;
		case '9': charLeft = size * 9; break;

		case 'a': charLeft = size * 10; break;
		case 'b': charLeft = size * 11; break;
		case 'c': charLeft = size * 12; break;
		case 'd': charLeft = size * 13; break;
		case 'e': charLeft = size * 14; break;
		case 'f': charLeft = size * 15; break;
		case 'g': charLeft = size * 16; break;
		case 'h': charLeft = size * 17; break;
		case 'i': charLeft = size * 18; break;
		case 'j': charLeft = size * 19; break;
		case 'k': charLeft = size * 20; break;
		case 'l': charLeft = size * 21; break;
		case 'm': charLeft = size * 22; break;
		case 'n': charLeft = size * 23; break;
		case 'o': charLeft = size * 24; break;
		case 'p': charLeft = size * 25; break;
		case 'q': charLeft = size * 26; break;
		case 'r': charLeft = size * 27; break;
		case 's': charLeft = size * 28; break;
		case 't': charLeft = size * 29; break;
		case 'u': charLeft = size * 30; break;
		case 'v': charLeft = size * 31; break;
		case 'w': charLeft = size * 32; break;
		case 'x': charLeft = size * 33; break;
		case 'y': charLeft = size * 34; break;
		case 'z': charLeft = size * 35; break;
		case ':': charLeft = size * 36; break;
		case '.': charLeft = size * 37; break;
		case ' ': charLeft = size * 38; break;
	};


	if(isRed) charTop = size;
	context.drawImage(charImg, charLeft, charTop, size, size, x, y, size, size);
},


checkCollision = function(elA, elB, callback){
	if(elA.x + elA.width >= elB.x && elA.x <= elB.x + elB.width && elA.y <= elB.y + elB.height && elA.y + elA.height >= elB.y){
		callback(elA, elB);
	}
};
var levelMap = [
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', 'V', 'B', 'B', 'B', 'B', 'm', 'V', 'B', 'B', 'B', 'B', 'm', ' ', ' '],
	[' ', ' ', 'X', 'B', 'O', 'P', 'B', 'W', 'e', 'B', 'O', 'P', 'B', 'n', ' ', ' '],
	['w', 'w', 'W', 'B', 'o', 'p', 'B', 'n', 'X', 'B', 'o', 'p', 'B', 'e', 'w', 'w'],
	[' ', ' ', 'X', 'B', 'B', 'B', 'B', 'W', 'e', 'B', 'B', 'B', 'B', 'n', ' ', ' '],
	[' ', ' ', 'v', 'b', 'b', 'b', 'b', 'N', 'v', 'b', 'b', 'b', 'b', 'N', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', 'V', 'g', 'g', 'm', 'V', 'g', 'g', 'm', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', 'X', 'r', 'R', 'n', 'X', 'R', 'r', 'n', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', 'X', 'g', 'g', 'n', 'X', 'g', 'g', 'n', ' ', ' ', ' ', ' '],
	['V', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'm'],
	['e', 'R', 'B', 'r', 'B', 'r', 'B', 'r', 'r', 'B', 'r', 'B', 'r', 'B', 'R', 'W'],
	['X', 'B', 'B', 'B', 'B', 'B', 'B', 'r', 'r', 'B', 'B', 'B', 'B', 'B', 'B', 'n'],
	['v', 'b', 'b', 'b', 'b', 'b', 'A', 'B', 'B', 'a', 'b', 'b', 'b', 'b', 'b', 'N'],
	[' ', ' ', ' ', ' ', ' ', ' ', 'X', 'g', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' '],
	['g', 'g', 'g', 'm', 'V', 'g', 'g', 'g', 'g', 'g ','g', 'm', 'V', 'g', 'g', 'g'],
	['r', 'R', 'r', 'W', 'e', 'g', 'g', 'g', 'g', 'g', 'g', 'W', 'e', 'r', 'R', 'g'],
	['g', 'r', 'g', 'n', 'X', 'g', 'g', 'g', 'g', 'g', 'g', 'n', 'X', 'g', 'r', 'g'],
	['b', 'b', 'b', 'N', 'X', 'r', 'r', 'g', 'g', 'r', 'r', 'n', 'v', 'b', 'b', 'b'],
	[' ', ' ', ' ', ' ', 'Z', 'M', 'M', 'g', 'g', 'M', 'M', 'z', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', 'X', 'r', 'r', 'g', 'g', 'r', 'r', 'n', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', 'Z', 'M', 'M', 'G', 'G', 'M', 'M', 'z', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', 'X', 'r', 'r', 'g', 'g', 'r', 'r', 'n', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', 'Z', 'M', 'M', 'g', 'g', 'M', 'M', 'z', ' ', ' ', ' ', ' '],
	[' ', ' ', 'V', 'K', 'L', 'r', 'r', 'g', 'g', 'r', 'r', 'K', 'L', 'm', ' ', ' '],
	['M', 'M', 'M', 'k', 'l', 'B', 'B', 'B', 'B', 'B', 'B', 'k' ,'l', 'M', 'M', 'M'],
	['g', 'g', 'g', 'B(-)','B','B','B', 'B', 'B', 'B', 'B', 'B(-)','B','g','g', 'g'],
	['r', 'g', 'r', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'r', 'g', 'r'],
	['r', 'g', 'r', 'B', 'B', 'B', 'B', 'r', 'r', 'B', 'B', 'B', 'B', 'r', 'g', 'r'],
	['r', 'g', 'r', 'B', 'B', 'B', 'B', 'K', 'L', 'B', 'B', 'B', 'B', 'r', 'g', 'r'],
	['r', 'g', 'r', 'B', 'B', 'B', 'B', 'k', 'l', 'B', 'B', 'B', 'B', 'r', 'g', 'r'],
	['r', 'g', 'r', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'r', 'g', 'r'],
	['r', 'g', 'r', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'r', 'g', 'r'],
	['r', 'g', 'r', 'B', 'B', 'B', 'B', 'r', 'r', 'B', 'B', 'B', 'B', 'r', 'g', 'r'],
	['g', 'g', 'g', 'B', 'B', 'B', 'B', 'R', 'R', 'B', 'B', 'B', 'B', 'g', 'g', 'g'],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'r', 'r', 'B', 'B', 'B', 'B', 'B', 'B', 'B'],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B'],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B'],
	['r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g'],
	['g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r'],
	['r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g'],
	['g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r'],
	['r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g'],
	['g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r'],
	['r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g'],
	['g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r'],
	['r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g'],
	['g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r'],
	['r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g'],
	['b', 'A', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'a', 'b', 'b'],
	[' ', 'X', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'n', ' ', ' '],
	[' ', 'Z', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'z', ' ', ' '],
	[' ', 'X', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'n', ' ', ' '],
	[' ', 'v', 'b', 'b', 'A', 'r', 'g', 'r', 'g', 'r', 'a', 'b', 'b', 'N', ' ', ' '],
	[' ', ' ', ' ', ' ', 'X', 'g', 'r', 'g', 'r', 'g', 'z', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', 'Z', 'r', 'g', 'r', 'g', 'r', 'n', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', 'X', 'g', 'r', 'g', 'r', 'g', 'z', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', 'v', 'b', 'b', 'b', 'b', 'b', 'N', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['g', 'r', 'g', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'm', ' ', ' '],
	['r', 'G', 'r', 'B', 'B', 'B', 'B', 'B', 'B', 'g', 'r', 'g', 'B', 'n', ' ', ' '],
	['g', 'r', 'g', 'B', 'B', 'g', 'g', 'B', 'B', 'r', 'G', 'r', 'B', 'n', ' ', ' '],
	['B', 'B(-)', 'B', 'B', 'r', 'r', 'r', 'r', 'B', 'g', 'r', 'g', 'B','z',' ',' '],
	['B', 'B', 'B', 'B', 'B', 'g', 'g', 'B', 'B', 'B', 'B', 'B', 'B', 'n', ' ', ' '],
	['B', 'B', 'B', 'K', 'L', 'K', 'L', 'K', 'L', 'B', 'B', 'B', 'B', 'W', 'w', 'w'],
	['B', 'B', 'B', 'k', 'l', 'k', 'l', 'k', 'l', 'B', 'B', 'B', 'B', 'n', ' ', ' '],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'n', ' ', ' '],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'a', 'b', 'b', 'N', ' ', ' '],
	['b', 'b', 'b', 'b', 'b', 'A', 'r', 'g', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', 'Z', 'g', 'r', 'g', 'r', 'z', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', 'X', 'r', 'g', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', 'V', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'm', ' ', ' ', ' '],
	[' ', ' ', ' ', 'X', 'B', 'M', 'r', 'g', 'r', 'g', 'M', 'B', 'n', ' ', ' ', ' '],
	[' ', ' ', ' ', 'Z', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'z', ' ', ' ', ' '],
	[' ', ' ', ' ', 'Z', 'B', 'M', 'r', 'g', 'r', 'g', 'M', 'B', 'z', ' ', ' ', ' '],
	[' ', ' ', ' ', 'v', 'b', 'b', 'A', 'B', 'B', 'a', 'b', 'b', 'N', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', 'X', 'g', 'r', 'n', ' ', ' ', ' ', ' ', ' ', ' '],
	['g', 'r', 'g', 'm', ' ', ' ', 'Z', 'K', 'L', 'z', ' ', ' ', 'V', 'g', 'r', 'g'],
	['g', 'r', 'g', 'W', 'w', 'w', 'e', 'k', 'l', 'W', 'w', 'w', 'e', 'g', 'r', 'g'],
	['g', 'r', 'g', 'n', ' ', ' ', 'v', 'b', 'b', 'N', ' ', ' ', 'X', 'g', 'r', 'g'],
	['g', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'g', 'r', 'g'],
	['g', 'r', 'g', 'z', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'Z', 'g', 'r', 'g'],
	['g', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'g', 'r', 'g'],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B'],
	['B', 'r', 'G', 'r', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'r', 'g', 'r', 'B'],
	['B', 'g', 'g', 'g', 'g', 'g', 'g', 'B', 'B', 'g', 'g', 'g', 'g', 'g', 'g', 'B'],
	['B', 'r', 'g', 'r', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'r', 'G', 'r', 'B'],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B'],
	['B', 'M', 'B', 'M', 'B', 'M', 'B', 'M', 'B', 'M', 'a', 'b', 'b', 'b', 'b', 'b'],
	['g', 'g', 'g', 'g', 'g', 'g', 'g', 'g', 'g', 'g', 'n', ' ', ' ', ' ', ' ', ' '],
	['r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'n', ' ', ' ', ' ', ' ', ' '],
	['g', 'K', 'L', 'g', 'g', 'g', 'g', 'K', 'L', 'g', 'n', ' ', ' ', ' ', ' ', ' '],
	['r', 'k', 'l', 'r', 'r', 'r', 'r', 'k', 'l', 'r', 'z', ' ', ' ', ' ', ' ', ' '],
	['g', 'g', 'g', 'g', 'g', 'g', 'g', 'g', 'g', 'g', 'n', ' ', ' ', ' ', ' ', ' '],
	['r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'n', ' ', ' ', ' ', ' ', ' '],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'M', 'g', 'M', 'B', 'B', 'B', 'B', 'B', 'B'],
	['B', 'g', 'r', 'g', 'r', 'B', 'B', 'g', 'r', 'g', 'B', 'B', 'B', 'B', 'B', 'B'],
	['B', 'g', 'r', 'g', 'r', 'B', 'B', 'M', 'r', 'M', 'B', 'B', 'B', 'B', 'B', 'B'],
	['b', 'b', 'A', 'g', 'r', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'M', 'g', 'M', 'B'],
	[' ', ' ', 'X', 'g', 'r', 'B', 'B', 'B', 'B', 'B ','B', 'B', 'g', 'R', 'g', 'B'],
	[' ', ' ', 'X', 'B', 'B', 'B', 'B', 'M', 'g', 'M', 'B', 'B', 'M', 'g', 'M', 'B'],
	[' ', ' ', 'Z', 'B', 'B', 'B', 'B', 'g', 'R', 'g', 'B', 'B', 'B', 'B', 'B', 'B'],
	[' ', ' ', 'Z', 'K', 'L', 'B', 'B', 'M', 'g', 'M', 'B', 'B', 'B', 'B', 'B', 'B'],
	['w', 'w', 'e', 'k', 'l', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'M', 'g', 'M', 'B'],
	[' ', ' ', 'v', 'b', 'A', 'K', 'L', 'B', 'B', 'B', 'B', 'B', 'g', 'R', 'g', 'B'],
	[' ', ' ', ' ', ' ', 'X', 'k', 'l', 'B', 'B', 'B', 'B', 'B', 'M', 'g', 'M', 'B'],
	[' ', ' ', ' ', ' ', 'v', 'b', 'b', 'b', 'b', 'A', 'B(-)', 'B', 'B','B','B','B'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'Z', 'B', 'B', 'B', 'B', 'B', 'B'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'v', 'b', 'b', 'b', 'b', 'b', 'b'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'V', 'r'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'R'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'Z', 'r'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'v', 'b'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['g', 'r', 'g', 'R ','g', 'r', 'g', 'm', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['B', 'B', 'B', 'B ','B', 'B', 'B', 'z', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['B', 'B', 'B', 'B ','B', 'B', 'B', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['B', 'B', 'B', 'B ','B', 'B', 'B', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['g', 'g', 'M', 'r ','r', 'B', 'B', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['g', 'g', 'B', 'r', 'r', 'B', 'B', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['g', 'g', 'B', 'r', 'r', 'B', 'B', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['g', 'g', 'M', 'r', 'r', 'B', 'B', 'z', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['r', 'r', 'r', 'r', 'r', 'r', 'r', 'z', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'z', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'n', ' ', ' ', 'V', 'r', 'r', 'r', 'm', ' '],
	['B', 'r', 'g', 'r', 'B', 'B', 'B', 'n', ' ', ' ', 'X', 'r', 'r', 'r', 'n', ' '],
	['B', 'r', 'g', 'B', 'r', 'K', 'L', 'W', 'w', 'w', 'e', 'B', 'M', 'B', 'z', ' '],
	['B', 'r', 'g', 'B', 'B', 'k', 'l', 'n', ' ', ' ', 'X', 'B', 'g', 'g', 'n', ' '],
	['B', 'r', 'g', 'B', 'B', 'M', 'r', 'z', ' ', ' ', 'Z', 'B', 'g', 'g', 'n', ' '],
	['b', 'b', 'b', 'A', 'r', 'g', 'r', 'n', ' ', ' ', 'X', 'B','B ', 'B', 'n', ' '],
	[' ', ' ', ' ', 'X', 'r', 'g', 'r', 'W', 'w', 'w', 'e', 'r', 'R', 'r', 'z', ' '],
	[' ', ' ', ' ', 'Z', 'B', 'B(-)', 'B', 'n', ' ', ' ', 'X', 'B', 'r','B','n',' '],
	[' ', ' ', ' ', 'Z', 'B', 'B', 'B', 'n', ' ', ' ', 'X', 'K', 'L', 'r', 'n', ' '],
	[' ', ' ', ' ', 'v', 'b', 'b', 'b', 'N', ' ', ' ', 'X', 'k', 'l', 'r', 'W', 'w'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'B', 'M', 'B', 'W', 'w'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'v', 'b', 'b', 'b', 'N', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ' ,' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'V', 'B', 'B', 'M', 'B' ,'g', 'B'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'M', 'B', 'M', 'B', 'M', 'B'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'K', 'L', 'M', 'g', 'r', 'B'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'k', 'l', 'M', 'B', 'M', 'B'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'M', 'B', 'M', 'K', 'L', 'B'],
	['r', 'r', 'g', 'r', 'r', 'm', ' ', ' ', ' ', 'X', 'g', 'R', 'M', 'k', 'l', 'B'],
	['g', 'g', 'g', 'g', 'g', 'n', ' ', ' ', ' ', 'X', 'M', 'B', 'M', 'B', 'M', 'B'],
	['r', 'G', 'g', 'r', 'r', 'n', ' ', ' ', ' ', 'X', 'M', 'B', 'M', 'B', 'M', 'B'],
	['g', 'r', 'g', 'g', 'g', 'n', ' ', ' ', ' ', 'X', 'M', 'B', 'M', 'B', 'M', 'B'],
	['g', 'r', 'g', 'r', 'a', 'N', 'V', 'r', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'r'],
	['g', 'r', 'g', 'r', 'n', ' ', 'X', 'g', 'r', 'g', 'r', 'g', 'r', 'g', 'G', 'g'],
	['g', 'r', 'g', 'r', 'W', 'w', 'e', 'M', 'g', 'r', 'g', 'M', 'g', 'r', 'g', 'M'],
	['g', 'r', 'G', 'r', 'W', 'w', 'e', 'B', 'B', 'B', 'B', 'B', 'M', 'r', 'M', 'B'],
	['g', 'r', 'g', 'R', 'n', ' ', 'v', 'b', 'b', 'b', 'A', 'B', 'g', 'M', 'g', 'B'],
	['b', 'b', 'b', 'b', 'N', ' ', ' ', ' ', ' ', ' ', 'X', 'B(-)', 'M','r','M','B'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'B', 'B', 'B', 'B', 'B'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'Z', 'g', 'g', 'M', 'r', 'r'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'g', 'g', 'B', 'r', 'r'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'g', 'g', 'M', 'r', 'r'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'g', 'G', 'B', 'r', 'r'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'g', 'g', 'M', 'r', 'r'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'g', 'g', 'B', 'R', 'r'],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'Z', 'g', 'g', 'M', 'r', 'r'],
	['r', 'g', 'r', 'm', ' ', ' ', ' ', ' ', ' ', ' ', 'Z', 'g', 'g', 'B', 'r', 'r'],
	['M', 'B', 'M', 'z', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'g', 'g', 'M', 'r', 'r'],
	['r', 'g', 'r', 'n', ' ', ' ', ' ', ' ', ' ', ' ', 'v', 'b', 'A', 'B', 'r', 'r'],
	['g', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'Z', 'M', 'B', 'M'],
	['r', 'G', 'r', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'v', 'b', 'b', 'b'],
	['g', 'M', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['r', 'g', 'r', 'z', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['g', 'M', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['r', 'g', 'r', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['b', 'b', 'b', 'N', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'm', ' ', ' ', ' '],
	['r', 'r', 'r ', 'B', 'g', 'g', 'g', 'B', 'r', 'r', 'r', 'B','n', ' ', ' ', ' '],
	['r', 'G', 'r', 'B', 'g', 'g', 'g', 'B', 'r', 'G', 'r', 'B', 'z', ' ', ' ', ' '],
	['r', 'r', 'r', 'B', 'g', 'g', 'g', 'B', 'r', 'r', 'r', 'B', 'W', 'w', 'w', 'w'],
	['B', 'B', 'B', 'B', 'B(-)', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'W','w','w','w'],
	['B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'B', 'n', ' ', ' ', ' '],
	['r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'r', 'W', 'w', 'w', 'w'],
	['M', 'g', 'M', 'g', 'M', 'g', 'M', 'B', 'M', 'B', 'M', 'B', 'n', ' ', ' ', ' '],
	['r', 'g', 'r', 'g', 'r', 'g', 'a', 'b', 'b', 'b', 'b', 'b', 'N', ' ', ' ', ' '],
	['r', 'g', 'M', 'G', 'r', 'G', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['r', 'g', 'r', 'g', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['M', 'g', 'r', 'g', 'M', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', 'V', 'K', 'L'],
	['r', 'g', 'r', 'g', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'k', 'l'],
	['R', 'g', 'M', 'g', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', 'Z', 'K', 'L'],
	['r', 'g', 'r', 'g', 'r', 'g', 'W', 'w', 'w', 'w', 'w', 'w', 'w', 'e', 'k', 'l'],
	['M', 'g', 'M', 'g', 'M', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'K', 'L'],
	['r', 'g', 'r', 'g', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', 'X', 'k', 'l'],
	['M', 'g', 'M', 'g', 'M', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', 'v', 'b', 'b'],
	['r', 'g', 'r', 'g', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['M', 'g', 'M', 'g', 'M', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	['b', 'b', 'b', 'A', 'r', 'g', 'z', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', 'Z', 'r', 'g', 'z', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', 'X', 'r', 'g', 'n', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', 'v', 'b', 'b', 'N', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' '],
	[' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ']
];
const start = function(){
	let menu = [
		{label: 'start game', action: 'startGame', active: true, index: 0},
		{label: 'options', action: 'showOptions', active: false, index: 1},
		{label: 'quit', action: 'quitGame', active: false, index: 2}
	], optionsMenu = [
		{label: 'toggle fullscreen', action: 'toggleFullscreen', active: true, index: 0},
		{label: 'back', action: 'cancelOptions', active: false, index: 1},
	], currentMenuItem = {}, optionsShowing = false, canMoveMenu = true; canPickMenu = true;

	const startLogoImg = new Image(),
		creditString = '2017 t.boddy',
		creditStringTwo = 'pre alpha 0.13',
		controlString = 'arrows or joystick:move',
		controlStringTwo = 'z or btns 1 to 4:shoot',
		controlStringThree = 'esc or btn 9: back to menu';
	startLogoImg.src = 'img/logo.png';

	const init = function(){
		$(window).resize(resizeGame);
		controls();
		loop = startLoop();
		canvasEl.show();
		if(savedData.fullscreen){
			mainWindow.setFullScreen(true);
			isFullscreen = true;
		}
		window.requestAnimationFrame(loop);
	},

	startLoop = function(){
		return function(){
			const draw = function(){
				context.drawImage(startLogoImg, (gameWidth / 2) - 64, grid * 1);
				if(optionsShowing){
					optionsMenu.forEach(function(item, i){
						const isActive = item.active ? true : false;
						drawString(item.label, textCenter(item.label), grid * (8 + (i * .5)), isActive);
					});
				} else {
					menu.forEach(function(item, i){
						const isActive = item.active ? true : false;
						drawString(item.label, textCenter(item.label), grid * (8 + (i * .5)), isActive);
					});
					drawString(controlString, textCenter(controlString), grid * 10.5, true);
					drawString(controlStringTwo, textCenter(controlStringTwo), grid * 11, true);
					drawString(controlStringThree, textCenter(controlStringThree), grid * 11.5, true);
					drawString(creditString, textCenter(creditString), grid * 13);
					drawString(creditStringTwo, textCenter(creditStringTwo), grid * 13.5);
				}
			};
			if(!gamepad) setupGamepad()
			clearGame();
			draw();
			updateStartGamepad();
			window.requestAnimationFrame(loop);
		};
	},

	updateStartGamepad = function(){
		if(!gamepad) setupGamepad()
		if(navigator.getGamepads()[0]){
			if(gamepad.axes[9]){
				const hatSwitch = gamepad.axes[9].toFixed(1);
				if(hatSwitch == '-1.0' && canMoveMenu) moveUpMenu();
				else if(hatSwitch == '0.1' && canMoveMenu) moveDownMenu();
				else if(hatSwitch == '3.3' && !canMoveMenu) canMoveMenu = true;
			} else {
				if(gamepad.axes[1] <= analogThresh * -1 && canMoveMenu) moveUpMenu();
				else if(gamepad.axes[1] >= analogThresh && canMoveMenu) moveDownMenu();
				// else if(!canPick) canPick = true;
			}
			if((gamepad.buttons[9].pressed || gamepad.buttons[0].pressed || gamepad.buttons[1].pressed || gamepad.buttons[3].pressed || gamepad.buttons[2].pressed) && canPickMenu) selectMenuItem();
			else if((!gamepad.buttons[9].pressed && !gamepad.buttons[0].pressed && !gamepad.buttons[1].pressed && !gamepad.buttons[3].pressed && !gamepad.buttons[2].pressed) && !canPickMenu) canPickMenu = true;
		}
	},

	textCenter = function(string){
		return (gameWidth / 2) - (string.length * (grid / 4));
	},

	controls = function(){
		setupKeyboard();
		navigator.getGamepads()[0] ? setupGamepad() : window.addEventListener('gamepadconnected', setupGamepad);
	},

	moveUpMenu = function(){
		canMoveMenu = false;
		getCurrentMenuItem();
		const menuArr = optionsShowing ? optionsMenu : menu;
		if(menuArr[currentMenuItem.index - 1]){
			menuArr[currentMenuItem.index].active = false;
			menuArr[currentMenuItem.index - 1].active = true;
		}
	},

	moveDownMenu = function(){
		canMoveMenu = false;
		getCurrentMenuItem();
		const menuArr = optionsShowing ? optionsMenu : menu;
		if(menuArr[currentMenuItem.index + 1]){
			menuArr[currentMenuItem.index].active = false;
			menuArr[currentMenuItem.index + 1].active = true;
		}
	},

	selectMenuItem = function(){
		canPickMenu = false;
		getCurrentMenuItem();
		eval(currentMenuItem.action + '()');
	},

	getCurrentMenuItem = function(){
		const menuArr = optionsShowing ? optionsMenu : menu;
		menuArr.forEach(function(item, i){
			if(item.active) currentMenuItem = item;
		});
	},

	startGame = function(){
		if(!startedGame){
			stopKeyboard();
			startedGame = true;
			clearGame();
			initGame();
		}
	},

	setupGamepad = function(){
		gamepad = navigator.getGamepads()[0];
	},

	setupKeyboard = function(){
		document.addEventListener('keydown', keysDown);
	}, 

	stopKeyboard = function(){
		document.removeEventListener('keydown', keysDown);
	},

	keysDown = function(e){
		switch(e.which){
			case 38: moveUpMenu(); break;
			case 40: moveDownMenu(); break;
			case 13: selectMenuItem(); break;
			case 90: selectMenuItem(); break;
		};
	},

	showOptions = function(){
		optionsShowing = true;
	},

	toggleFullscreen = function(){
		const openFullscreen = function(){
			mainWindow.setFullScreen(true);
			isFullscreen = true;
			savedData.fullscreen = true;
			storage.set('savedData', savedData);
		}, closeFullscreen = function(){
			mainWindow.setFullScreen(false);
			isFullscreen = false;
			savedData.fullscreen = false;
			storage.set('savedData', savedData);
		};
		isFullscreen ? closeFullscreen() : openFullscreen();
	},

	cancelOptions = function(){
		optionsShowing = false;
		optionsMenu.forEach(function(menuItem, i){
			menuItem.active = i == 0 ? true : false;
		});
	},

	quitGame = function(){
		mainWindow.close();
	};

	storage.get('savedData', function(err, data){
		savedData = data;
		init();
	});
	
};
let gameLoopInterval, isGameOver = false, gameClock = 0;

const initGame = function(){
	setupLevel();
	setupPlayer();
	setupHighScore();
	// setupBackgroundMusic();
	loop = gameLoop();
},

gameLoop = function(){
	return function(){
		clearGame();
		levelLoop();
		secretLoop();
		enemyShootingLoop();
		enemiesLoop();
		pointerLoop();
		powerupLoop();
		shootingLoop();
		playerLoop();
		explosionsLoop();
		hudLoop();
		gameClock++;
		window.requestAnimationFrame(loop);
	};
},

setupBackgroundMusic = function(){
	const musicEl = '<audio autoplay style="display:none;position:absolute;top:-100px;left:-100px;">\
		<source src="sound/bg.ogg" type="audio/ogg"></source>\
		</audio>';
	$('body').append(musicEl);
};

let gridPositions = [], currentPlatformAnimation = 0, groundSpeed = 0.1, cloudSpeed = 0.2;
const levelSpeed = 0.8, introTime = 90, outroTime = 5050;

const setupLevel = function(){
	const levelStartPos = levelMap.length * grid;
	levelMap.forEach(function(levelRow, i){
		const rowY = (i * grid) - (levelStartPos - gameHeight);
		let gridPosition = {y: rowY, groundY: rowY, cloudY: rowY, grids: []};
		levelRow.forEach(function(levelGrid, j){
			gridPosition.grids.push({x: j * grid, char: levelRow[j]});
			if(levelGrid.indexOf('(') > -1){
				var xPos = j * grid, yPos = (i * grid) - (levelStartPos - gameHeight);
				secrets.push({x: xPos, y: yPos, width: grid * 2, height: grid * 2, hits: 12});
				// entity = levelGrid.substring(levelGrid.indexOf('(') + 1, levelGrid.indexOf('(') + 2);
				// switch(entity){
				// 	case '-': 
				// };
			}
		});
		gridPositions.push(gridPosition);
	});
	setupGridImages();
};

const greenBlockImg = new Image(), redBlockImg = new Image(), greenPointImg = new Image(), redPointImg = new Image(), destroyedImg = new Image(),
	platformOneImg = new Image(), platformTwoImg = new Image(), platformBottomImg = new Image(), platformBottomLeftImg = new Image(), platformBottomRightImg = new Image(), platformLeftImg = new Image(), platformTopLeftImg = new Image(),
	platformRightImg = new Image(), platformTopRightImg = new Image(), platformRightNubImg = new Image(), platformLeftNubImg = new Image(), platformIntersectTopLeftImg = new Image(), platformIntersectTopRightImg = new Image(),
	pipeImg = new Image(), pipeLeftImg = new Image(), pipeRightImg = new Image(), bigBlockImg = new Image(), destroyedBigBlockImg = new Image(), bigThingImg = new Image(), destroyedSecretBlockImg = new Image();

const setupGridImages = function(){
	greenBlockImg.src = 'img/greenblock.png';
	redBlockImg.src = 'img/redblock.png';
	greenPointImg.src = 'img/greenpoint.png';
	redPointImg.src = 'img/greenpoint.png';
	destroyedImg.src = 'img/destroyed.png';

	platformOneImg.src = 'img/platform1.png';
	platformTwoImg.src = 'img/platform2.png';
	platformBottomImg.src = 'img/platformbottom.png';
	platformBottomLeftImg.src = 'img/platformbottomleft.png';
	platformBottomRightImg.src = 'img/platformbottomright.png';
	platformLeftImg.src = 'img/platformleft.png';
	platformTopLeftImg.src = 'img/platformtopleft.png';
	platformRightImg.src = 'img/platformright.png';
	platformTopRightImg.src = 'img/platformtopright.png';
	platformLeftNubImg.src = 'img/platformleftnub.png';
	platformRightNubImg.src = 'img/platformrightnub.png';
	platformIntersectTopLeftImg.src = 'img/platformintersecttopleft.png';
	platformIntersectTopRightImg.src = 'img/platformintersecttopright.png';

	pipeImg.src = 'img/pipe.png';
	pipeLeftImg.src = 'img/pipeleft.png';
	pipeRightImg.src = 'img/piperight.png';

	bigBlockImg.src = 'img/bigblock.png';
	destroyedBigBlockImg.src = 'img/destroyedbigblock.png';

	bigThingImg.src = 'img/bigthing.png';

	destroyedSecretBlockImg.src = 'img/destroyedsecretblock.png';
},

levelLoop = function(){

	var update = function(){
		if(gameClock % 16 == 0){
			currentPlatformAnimation++;
			if(currentPlatformAnimation == 4) currentPlatformAnimation = 0;
		}
		for(var i in gridPositions){
			gridPositions[i].y += levelSpeed;
			gridPositions[i].groundY += groundSpeed;
			gridPositions[i].cloudY += cloudSpeed;
		}
		updateBlocks();
	};

	var draw = function(){

		var drawForeground = function(row, i){
			var rowY = gridPositions[i].y
			if(rowY + grid >= 0 && rowY <= gameHeight){
				row.forEach(function(levelGrid, j){
					if(levelGrid != ' '){
						var img;
						if(levelGrid.indexOf('(') > -1) levelGrid = levelGrid.substring(0, levelGrid.indexOf('('));
						levelGrid = levelGrid.trim();
						if(levelGrid != ''){
							switch(levelGrid){
								case 'g': img = greenBlockImg; break;
								case 'r': img = redBlockImg; break;
								case 'G': img = greenPointImg; break;
								case 'R': img = redPointImg; break;
								case 't': img = destroyedImg; break;
								case 'B': img = platformOneImg; break;
								case 'M': img = platformTwoImg; break;
								case 'b': img = platformBottomImg; break;
								case 'v': img = platformBottomLeftImg; break;
								case 'N': img = platformBottomRightImg; break;
								case 'X': img = platformLeftImg; break;
								case 'V': img = platformTopLeftImg; break;
								case 'n': img = platformRightImg; break;
								case 'm': img = platformTopRightImg; break;
								case 'Z': img = platformLeftNubImg; break;
								case 'z': img = platformRightNubImg; break;
								case 'a': img = platformIntersectTopLeftImg; break;
								case 'A': img = platformIntersectTopRightImg; break;
								case 'w': img = pipeImg; break;
								case 'W': img = pipeLeftImg; break;
								case 'e': img = pipeRightImg; break;
								case 'k': img = bigBlockImg; break;
								case 'K': img = bigBlockImg; break;
								case 'l': img = bigBlockImg; break;
								case 'L': img = bigBlockImg; break;
								case 'u': img = destroyedBigBlockImg; break;
								case 'U': img = destroyedBigBlockImg; break;
								case 'i': img = destroyedBigBlockImg; break;
								case 'I': img = destroyedBigBlockImg; break;
								case 'o': img = bigThingImg; break;
								case 'O': img = bigThingImg; break;
								case 'p': img = bigThingImg; break;
								case 'P': img = bigThingImg; break;
								case 'q': img = destroyedSecretBlockImg; break;
								case 'Q': img = destroyedSecretBlockImg; break;
								case 'y': img = destroyedSecretBlockImg; break;
								case 'Y': img = destroyedSecretBlockImg; break;
							}
							if(levelGrid == 'K' || levelGrid == 'O' || levelGrid == 'U' || levelGrid == 'q') context.drawImage(img, 0, 0, grid, grid, (j * grid), rowY, grid, grid);
							else if(levelGrid == 'k' || levelGrid == 'o' || levelGrid == 'u' || levelGrid == 'Q') context.drawImage(img, 0, grid, grid, grid, (j * grid), rowY, grid, grid);
							else if(levelGrid == 'L' || levelGrid == 'P' || levelGrid == 'I' || levelGrid == 'y') context.drawImage(img, grid, 0, grid, grid, (j * grid), rowY, grid, grid);
							else if(levelGrid == 'l' || levelGrid == 'p' || levelGrid == 'i' || levelGrid == 'Y') context.drawImage(img, grid, grid, grid, grid, (j * grid), rowY, grid, grid);
							else if(levelGrid == 'b' || levelGrid == 'N' || levelGrid == 'v' || levelGrid == 'a' || levelGrid == 'A'){
								var sX = 0;
								switch(currentPlatformAnimation){
									case 0: sX = 0; break;
									case 1: sX = grid; break;
									case 2: sX = grid * 2; break;
									case 3: sX = grid; break;
								};
								context.drawImage(img, sX, 0, grid, grid, (j * grid), rowY, grid, grid);
							}
							else context.drawImage(img, (j * grid), rowY);
						}
					} else {
						context.fillStyle = 'transparent';
						context.fillRect((j * grid), rowY, grid, grid);
					}
				});
			}
		};

		var drawLayer = function(type){
			levelMap.forEach(function(row, i){
				switch(type){
					case 'ground':
						const groundY = gridPositions[i].groundY * grid;
						if(groundY + (grid * grid) >= 0 && groundY <= gameHeight){
					 		const groundEl = new Image();
					 		groundEl.src = 'img/stars1.png';
					 		context.drawImage(groundEl, 0, groundY);
						}
						break;
					case 'clouds':
						const cloudY = gridPositions[i].cloudY * grid;
						if(cloudY + (grid * grid) >= 0 && cloudY <= gameHeight){
					 		const cloudEl = new Image();
					 		cloudEl.src = 'img/stars2.png';
					 		context.drawImage(cloudEl, 0, cloudY);
						}
						break;
					case 'foreground':
						drawForeground(row, i);
						break;
				};
			});
		};

		var drawIntro = function(){
			var newGround = 1 / 64;
			if(gameClock < introTime - 50) newGround = 1;
			else if(gameClock >= introTime - 50 && gameClock < introTime - 40) newGround = 1 / 2;
			else if(gameClock >= introTime - 40 && gameClock < introTime - 30) newGround = 1 / 4;
			else if(gameClock >= introTime - 30 && gameClock < introTime - 20) newGround = 1 / 8;
			else if(gameClock > introTime - 20 && gameClock < introTime - 10) newGround = 1 / 16;
			else if(gameClock > introTime - 10 && gameClock < introTime || gameClock >= outroTime && gameClock < outroTime + 10) newGround = 1 / 32;
			else if(gameClock >= outroTime + 10 && gameClock < outroTime + 20) newGround = 1 / 16;
			else if(gameClock >= outroTime + 20 && gameClock < outroTime + 30) newGround = 1 / 8;
			else if(gameClock >= outroTime + 30 && gameClock < outroTime + 40) newGround = 1 / 4;
			else if(gameClock >= outroTime + 40 && gameClock < outroTime + 50) newGround = 1 / 2;
			else if(gameClock >= outroTime + 50) newGround = 1;
			groundSpeed = newGround;
			cloudSpeed = newGround * 2;
		};

		drawLayer('ground');
		drawLayer('clouds');
		drawLayer('foreground');
		drawIntro();

	};

	update();
	draw();

};
const updateBlocks = () => {
	levelMap.forEach((row, i) => {
		if(gridPositions[i].y + grid >= 0 && gridPositions[i].y <= gameHeight){
			row.forEach((levelGrid, j) => {
				let gridChar = gridPositions[i].grids[j].char;
				if(gridChar.indexOf('(') > -1) gridChar = gridChar.substring(0, gridChar.indexOf('('));
				const gridObj = {x: gridPositions[i].grids[j].x, y: gridPositions[i].y, char: gridChar};
				gridChar = gridChar.trim();
				if(gridChar == 'g' || gridChar == 'G' || gridChar == 'r' || gridChar == 'R') checkBlockCollision(gridObj);
				else if(gridChar == 'k' || gridChar == 'K' || gridChar == 'l' || gridChar == 'L') checkBigBlockCollision(gridObj);
			});
		}
	});
},

checkBlockCollision = (block) => {
	checkBulletCollision({x: block.x, y: block.y, width: grid, height: grid}, () => {
		destroyBlock(block);
	});
},

destroyBlock = (block) => {
	levelMap.forEach((row, i) => {
		row.forEach((char, j) => {
			let gridChar = char;
			if(gridChar.indexOf('(') > -1) gridChar = gridChar.substring(0, gridChar.indexOf('('));
			if(gridPositions[i].grids[j].x == block.x && gridPositions[i].y == block.y && block.char == gridChar){
				if(block.char == 'G' || block.char == 'R') spawnPointer(block);
				block.width = grid;
				block.height = grid;
				explodeEntity(block, gameClock);
				levelMap[i][j] = 't';
				gridPositions[i].grids[j].char = 't';
				score += 10;
			}
		});
	});
},

checkBigBlockCollision = (bigBlock) => {
	checkBulletCollision({x: bigBlock.x, y: bigBlock.y, width: grid, height: grid}, () => {
		let gridsToDestroy = {};
		switch(bigBlock.char.trim()){
			case 'k':
				gridsToDestroy.topLeft = {x: bigBlock.x, y: bigBlock.y - grid};
				gridsToDestroy.topRight = {x: bigBlock.x + grid, y: bigBlock.y - grid};
				gridsToDestroy.bottomLeft = bigBlock;
				gridsToDestroy.bottomRight = {x: bigBlock.x + grid, y: bigBlock.y};
				break;
			case 'K':
				gridsToDestroy.topLeft = bigBlock;
				gridsToDestroy.topRight = {x: bigBlock.x + grid, y: bigBlock.y};
				gridsToDestroy.bottomLeft = {x: bigBlock.x, y: bigBlock.y + grid};
				gridsToDestroy.bottomRight = {x: bigBlock.x + grid, y: bigBlock.y + grid};
				break;
			case 'l':
				gridsToDestroy.topLeft = {x: bigBlock.x - grid, y: bigBlock.y - grid};
				gridsToDestroy.topRight = {x: bigBlock.x, y: bigBlock.y - grid};
				gridsToDestroy.bottomLeft = {x: bigBlock.x - grid, y: bigBlock.y};
				gridsToDestroy.bottomRight = bigBlock;
				break;
			case 'L':
				gridsToDestroy.topLeft = {x: bigBlock.x - grid, y: bigBlock.y};
				gridsToDestroy.topRight = bigBlock;
				gridsToDestroy.bottomLeft = {x: bigBlock.x - grid, y: bigBlock.y - grid};
				gridsToDestroy.bottomRight = {x: bigBlock.x, y: bigBlock.y - grid};
				break;
		};
		destroyBigBlock(gridsToDestroy);
	});
},

destroyBigBlock = (gridsToDestroy) => {
	levelMap.forEach((row, i) => {
		row.forEach((char, j) => {
			let gridChar = char;
			if(gridChar.indexOf('(') > -1) gridChar = gridChar.substring(0, gridChar.indexOf('('));
			gridChar = gridChar.trim();
			if(gridChar.indexOf('k') > -1 || gridChar.indexOf('K') > -1 || gridChar.indexOf('l') > -1 || gridChar.indexOf('L') > -1){
				const otherRowIndex = (gridChar.indexOf('K') > -1 || gridChar.indexOf('L') > -1) ? i + 1 : i - 1;
				for(let cord in gridsToDestroy){
					if(gridPositions[i].grids[j].x == gridsToDestroy[cord].x && gridPositions[i].y == gridsToDestroy[cord].y){
						let newChar = '', newOtherChar = '', tempGrid = levelMap[i][j], tempOtherGrid = levelMap[otherRowIndex][j];
						if(tempGrid.indexOf('(') > -1) tempGrid = tempGrid.substring(0, tempGrid.indexOf('('));
						if(tempOtherGrid.indexOf('(') > -1) tempOtherGrid = tempOtherGrid.substring(0, tempOtherGrid.indexOf('('));
						tempGrid = tempGrid.trim();
						tempOtherGrid = tempOtherGrid.trim();
						switch(tempGrid){
							case 'k': newChar = 'u'; break;
							case 'K': newChar = 'U'; break;
							case 'l': newChar = 'i'; break;
							case 'L': newChar = 'I'; break;
						};
						switch(tempOtherGrid){
							case 'k': newOtherChar = 'u'; break;
							case 'K': newOtherChar = 'U'; break;
							case 'l': newOtherChar = 'i'; break;
							case 'L': newOtherChar = 'I'; break;
						};
						levelMap[i][j] = newChar;
						gridPositions[i].grids[j].char = newChar;
						levelMap[otherRowIndex][j] = newOtherChar;
						gridPositions[otherRowIndex].grids[j].char = newOtherChar;
					}
				};
			}
		});
	});
	explodeEntity({x: gridsToDestroy.topLeft.x, y: gridsToDestroy.topLeft.y, width: grid * 2, height: grid * 2});
	score += 200;
};
let secrets = [], bonusCount = 1;

const secretImg = new Image(), secretDestroyedImage = new Image();
secretImg.src = 'img/secret.png';
secretDestroyedImage.src = 'img/destroyedsecretblock.png';

const secretLoop = function(){
	const draw = function(){
		secrets.forEach(function(secretObj, i){
			secretObj.y += levelSpeed;
			if(secretObj.y + secretObj.height >= 0){
				secretObj.hits <= 0 ? context.drawImage(secretDestroyedImage, secretObj.x, secretObj.y) : context.drawImage(secretImg, secretObj.x, secretObj.y);
				const secretCollisionEl = {x: secretObj.x, y: secretObj.y, width: secretObj.width, height: secretObj.height};
				if(secretObj.hits >= 0){
					checkBulletCollision(secretCollisionEl, function(){
						explodeEntity(secretCollisionEl);
						secretObj.hits -= 1;
						if(secretObj.hits == 0){
							score += bonusCount * 1000;
							fullscreenMessageTime = 0;
							currentFullscreenMessage = 'bonus: ' + (bonusCount * 1000);
							bonusCount++;
						}
					});
				}
				if(secretObj.y >= gameHeight + grid) secrets.splice(i, 1);
			}
		});
	};
	if(secrets.length) draw();
};
let pointers = [];

const pointerImg = new Image();
pointerImg.src = 'img/pointer.png';

const spawnPointer = function(block){
	pointers.push({x: block.x + (grid / 4), y: block.y + (grid / 4), initial: block.x, count: 0});
},

pointerLoop = function(){
	const draw = function(){
		const animatePointers = function(){
			pointers.forEach(function(pointerObj, i){
				pointerObj.width = grid / 2;
				const increase = 90 / 180 * Math.PI / (grid * 2),
					offsetNum = pointerObj.initial >= gameWidth / 2 ? 0.2 : -0.2;
				pointers[i].x = (pointerObj.x - Math.sin(pointerObj.count) * (grid * offsetNum));
				pointers[i].count += increase;
				context.drawImage(pointerImg, pointerObj.x, pointerObj.y);
				pointers[i].y += 0.67;
				if(pointerObj.y >= gameHeight) pointers.splice(i, 1);
				checkPointerCollision(pointerObj, i);
			});
		},
		checkPointerCollision = function(pointerObj, i){
			const pointerEl = {x: pointerObj.x, y: pointerObj.y, width: grid, height: grid}, playerEl = {x: playerX, y: playerY, width: grid, height: grid};
			checkCollision(pointerEl, playerEl, function(pointerEl, playerEl){
				pointers.splice(i, 1);
				score += 150;
			});
		};
		animatePointers();
	};
	if(pointers.length) draw();
};

const enemySmallOneImg = new Image(), enemySmallTwoImg = new Image(), enemySmallFourImg = new Image(), enemySmallFiveImg = new Image(), enemySmallFiveBottomLeftImg = new Image(),
enemySmallFiveBottomRightImg = new Image(), enemyMediumOneImg = new Image(), bossOneImg = new Image(), bossTwoImg = new Image();
enemySmallOneImg.src = 'img/enemysmallone.png';
enemySmallTwoImg.src = 'img/enemysmalltwo.png';
enemyMediumOneImg.src = 'img/enemymediumone.png';
enemySmallFourImg.src = 'img/enemysmallthree.png';
enemySmallFiveImg.src = 'img/enemysmallfive.png';
enemySmallFiveBottomLeftImg.src = 'img/enemysmallfivebottomleft.png';
enemySmallFiveBottomRightImg.src = 'img/enemysmallfivebottomright.png';
bossOneImg.src = 'img/bossonea.png';
bossTwoImg.src = 'img/bossoneb.png';

const bossOneAImg = new Image(), bossOneBImg = new Image();
bossOneAImg.src = 'img/bossonea.png';
bossOneBImg.src = 'img/bossoneb.png';

let currentWave, leftBossShoot = true;

const bossOneInterval = fps * 2.5;


const enemyAnimations = {
	small: {
		one: function(enemy){
			enemy.y += 0.75;
			const increase = 90 / 180 * Math.PI / (grid * 1.67);
			enemy.x = enemy.initial - Math.sin(enemy.count) * (grid * 6.5);
			enemy.count += increase;
			return enemy;
		},
		two: function(enemy){
			let vel = 2;
			const trackPlayer = function(){
				const dAngle = Math.atan2(playerY - enemy.y, playerX - enemy.x);
				enemy.x += vel * Math.cos(dAngle);
				if(enemy.y <= grid * 2) vel = 3;
				if(enemy.y < grid * 2 && enemy.y <= grid * 3) vel = 3.5;
				if(enemy.y < grid * 3 && enemy.y <= grid * 4) vel = 4;
				if(enemy.y < grid * 4 && enemy.y <= grid * 5) vel = 3.5;
				if(enemy.y < grid * 5 && enemy.y <= grid * 6) vel = 3;
				if(enemy.y < grid * 6 && enemy.y <= grid * 7) vel = 2.5;
				enemy.y += vel * Math.sin(dAngle);
				context.save();
				context.translate(enemy.x, enemy.y);
				context.rotate(dAngle - degToRad(90))
				context.drawImage(enemySmallFiveImg, enemy.width / -2, enemy.height / -2);
				context.restore();
			}, goUp = function(){
				enemy.y -= vel;
				context.save();
				context.translate(enemy.x, enemy.y);
				context.rotate(degToRad(180));
				context.drawImage(enemySmallFiveImg, enemy.width / -2, enemy.height / -2);
				context.restore();
			};
			enemy.hits == 2 ? trackPlayer() : goUp();
			return enemy;
		},
		three: function(enemy){
			enemy.y += 2;
			if(!enemy.dAngle){
				enemy.dAngle = Math.atan2(playerY - enemy.y, playerX - enemy.x);
			}
			enemy.x += 2 * Math.cos(enemy.dAngle);
			context.save();
			context.translate(enemy.x, enemy.y);
			context.rotate(enemy.dAngle - degToRad(90));
			context.drawImage(enemySmallFourImg, enemy.width / -2, enemy.height / -2);
			context.restore();
			return enemy;
		},
		four: function(enemy){
			if(enemy.y >= (gameHeight / 3) * 2 && enemy.direction == 'downRight') enemy.direction = 'upRight';
			else if(enemy.direction == 'upRight' && enemy.y <= gameHeight / 3) enemy.direction = 'downAgain';
			if(enemy.y >= (gameHeight / 3) * 2 && enemy.direction == 'downLeft') enemy.direction = 'upLeft';
			else if(enemy.direction == 'upLeft' && enemy.y <= gameHeight / 3) enemy.direction = 'downAgain';
			const yVel = 2, xVel = 0.75;
			switch(enemy.direction){
				case 'downRight':
					enemy.y += yVel;
					break;
				case 'downLeft':
					enemy.y += yVel;
					break;
				case 'upRight':
					enemy.y -= yVel;
					enemy.x += xVel;
					break;
				case 'upLeft':
					enemy.y -= yVel;
					enemy.x -= xVel;
					break;
				case 'downAgain':
					enemy.y += yVel;
					break;
			};
			return enemy;
		},
		five: function(enemy){
			const vel = 3, rotateSpeed = 0.035, rotateRadius = grid * 5;
			if(!enemy.angle) enemy.angle = 0;
			if(!enemy.initial) enemy.initial = enemy.x;
			if(enemy.y <= (gameHeight / 2) - (grid * 0.4) && !enemy.startedCircle){
				enemy.y += vel;
			} else {
				if(!enemy.startedCircle) enemy.startedCircle = true;
				if(enemy.y <= grid * 2.55){
					enemy.x += vel;
				} else {
					enemy.x = ((gameWidth / 2) - grid) + Math.cos(enemy.angle) * rotateRadius;
					enemy.y = (gameHeight / 2) + Math.sin(enemy.angle) * rotateRadius;
					enemy.angle += rotateSpeed;
				}
			}
			return enemy;
		},
		six: function(enemy){
			const vel = 2;
			if(enemy.y <= enemy.limit && !enemy.hitLimit){
				enemy.y += vel * 1.33;
				context.drawImage(enemySmallFourImg, enemy.x, enemy.y);
			} else {
				if(!enemy.hitLimit) {
					enemy.hitLimit = true;
					enemy.xTarget = playerX;
					enemy.yTarget = playerY;
					enemy.dAngle = Math.atan2(enemy.yTarget - enemy.y, enemy.xTarget - enemy.x);
					enemy.xPath = vel * Math.cos(enemy.dAngle);
					enemy.yPath = vel * Math.sin(enemy.dAngle);
				}
				enemy.x += enemy.xPath;
				enemy.y += enemy.yPath;
				context.save();
				context.translate(enemy.x, enemy.y);
				context.rotate(enemy.dAngle - degToRad(90));
				context.drawImage(enemySmallFourImg, enemy.width / -2, enemy.height / -2);
				context.restore();
			}
			return enemy;
		},
		seven: function(enemy){
			if(enemy.y <= gameHeight / 2 && !enemy.hitBottom){
				enemy.y += 2;
			} else {
				const xVel = 1.5;
				if(!enemy.hitBottom) enemy.hitBottom = true;
				enemy.y -= 0.75;
				enemy.direction == 'right' ? enemy.x += xVel : enemy.x -= xVel;
				if(!enemy.hasShot && enemy.y <= gameHeight / 2){
					spawnShots.small.seven(enemy);
					enemy.hasShot = true;
				}
			}
			return enemy;
		},
		eight: function(enemy){
			if(enemy.y <= (gameHeight / 3) && enemy.direction == 'downRight') enemy.direction = 'upRight';
			else if(enemy.direction == 'upRight' && enemy.y >= (gameHeight / 3) * 2) enemy.direction = 'upAgain';
			if(enemy.y <= (gameHeight / 3) && enemy.direction == 'downLeft') enemy.direction = 'upLeft';
			else if(enemy.direction == 'upLeft' && enemy.y >= (gameHeight / 3) * 2) enemy.direction = 'upAgain';
			const yVel = 2, xVel = 0.75;
			switch(enemy.direction){
				case 'downRight':
					enemy.y -= yVel;
					break;
				case 'downLeft':
					enemy.y -= yVel;
					break;
				case 'upRight':
					enemy.y += yVel;
					enemy.x += xVel;
					break;
				case 'upLeft':
					enemy.y += yVel;
					enemy.x -= xVel;
					break;
				case 'upAgain':
					enemy.y -= yVel;
					break;
			};
			return enemy;
		},
		nine: function(enemy){
			const vel = 3, rotateSpeed = 0.035, rotateRadius = grid * 5;
			if(!enemy.angle) enemy.angle = 0;
			if(!enemy.initial) enemy.initial = enemy.x;
			if(enemy.y <= (gameHeight / 2) - (grid * 0.4) && !enemy.startedCircle){
				enemy.y += vel;
			} else {
				if(!enemy.startedCircle) enemy.startedCircle = true;
				if(enemy.y <= grid * 2.55){
					enemy.x -= vel;
				} else {
					enemy.x = ((gameWidth / 2) - grid) + Math.cos(enemy.angle) * -rotateRadius;
					enemy.y = (gameHeight / 2) + Math.sin(enemy.angle) * rotateRadius;
					enemy.angle += rotateSpeed;
				}
			}
			return enemy;
		}
	},
	medium: {
		one(enemy){
			if(!enemy.started){
				enemy.y = gameHeight;
				enemy.started = true;
				enemy.circleStarted = false;
			} else {
				if(enemy.circleStarted){
					if(enemy.circleFinished){
						if(enemy.reachedMiddle){
							if(!enemy.hCount){
								enemy.hCount = 0;
								enemy.hInitial = enemy.x;
							}
							const hIncrease = 90 / 180 * Math.PI / (grid * 5);
							enemy.x = enemy.hInitial - Math.sin(enemy.hCount) * (grid * 6);
							enemy.hCount -= hIncrease;
							if(!enemy.vCount){
								enemy.vCount = 0;
								enemy.vInitial = enemy.y;
							}
							const vIncrease = 90 / 180 * Math.PI / (grid * 2);
							enemy.y = enemy.vInitial - Math.sin(enemy.vCount) * (grid * 0.5);
							enemy.vCount -= vIncrease;
							if(enemy.y + enemy.height >= 0){
								const shotTime = 112, shotInterval = 15;
								if(gameClock % shotTime == 0 || gameClock % shotTime == shotInterval || gameClock % shotTime == (shotInterval * 2)) spawnShots.medium.one(enemy);
							}
						} else {
							enemy.x += 2;
							if(enemy.x >= (gameWidth / 2) - (enemy.width / 2)) enemy.reachedMiddle = true;
						}
					} else {
						const vel = 2, rotateSpeed = 0.03, rotateRadius = -grid * 4;
						if(!enemy.angle) enemy.angle = 0;
						if(!enemy.initial) enemy.initial = enemy.x;
						enemy.x = (gameWidth / 2) + Math.cos(enemy.angle) * rotateRadius;
						enemy.y = (gameHeight / 3) + Math.sin(enemy.angle) * rotateRadius;
						if(enemy.angle <= 1) enemy.angle += rotateSpeed;
						else enemy.circleFinished = true;
					}
				} else {
					if(enemy.y >= gameHeight / 3){
						enemy.y -= 2.5;
					} else {
						enemy.circleStarted = true;
					}
				}
			}
			return enemy;
		},
		two(enemy){
			const rotateRadius = grid * 2, rotateMulti = 0.99;
			if(enemy.angle <= 3.2 && enemy.rotateSpeed != enemy.rotateSpeed * rotateMulti) enemy.rotateSpeed = enemy.rotateSpeed * rotateMulti;
			if(!enemy.initial) enemy.initial = enemy.x;
			enemy.x = gameWidth + Math.cos(enemy.angle) * (rotateRadius * enemy.radiusMulti);
			enemy.y = enemy.initialY - (enemy.height / 2) + Math.sin(enemy.angle) * rotateRadius;
			enemy.angle -= enemy.rotateSpeed;
			if(enemy.angle <= 3.2 && gameClock % 16 == 0) spawnShots.medium.two(enemy);
			return enemy;
		},
		three(enemy){
			if(!enemy.started){
				enemy.y = gameHeight;
				enemy.started = true;
			} else {
				if(enemy.y >= gameHeight - (grid * 3)) enemy.y -= 2.5;
				else if(enemy.y >= gameHeight - (grid * 4) && enemy.y < gameHeight - (grid * 3)) enemy.y -= 2;
				else if(enemy.y >= gameHeight - (grid * 5) && enemy.y < gameHeight - (grid * 4)) enemy.y -= 1.5;
				else {
					enemy.y -= 1;
					const shotTime = 112, shotInterval = 15;
					if(gameClock % 24 == 0) spawnShots.medium.two(enemy);
				}
			}
			return enemy;
		},
		four(enemy){
			const rotateRadius = grid * 2, rotateMulti = 0.99;
			if(enemy.angle <= 3.2 && enemy.rotateSpeed != enemy.rotateSpeed * rotateMulti) enemy.rotateSpeed = enemy.rotateSpeed * rotateMulti;
			if(!enemy.initial) enemy.initial = enemy.x;
			if(enemy.goesRight){
				enemy.x = ((Math.cos(enemy.angle) * (rotateRadius * enemy.radiusMulti)) * -1) - (grid * 2);
			} else {
				enemy.x = gameWidth + Math.cos(enemy.angle) * (rotateRadius * enemy.radiusMulti);
			}
			enemy.y = enemy.initialY - (enemy.height / 2) + Math.sin(enemy.angle) * rotateRadius;
			enemy.angle -= enemy.rotateSpeed;
			if(enemy.angle <= 3.2 && gameClock % 16 == 0) spawnShots.medium.two(enemy);
			return enemy;
		}
	},
	boss: {
		one(enemy, i){
			const ySpeed = 0.075;
			if(enemy.y >= grid * 2) enemy.goUp = true;
			else if(enemy.y < grid) enemy.goUp = false;
			enemy.y = enemy.goUp ? enemy.y - ySpeed : enemy.y + ySpeed;
			enemy.x = enemy.x;
			if(gameClock % 10 == 0 && leftBossShoot) spawnShots.boss.one(enemy);
			return enemy;
		}, two(enemy, i){
			const ySpeed = 0.075;
			if(enemy.y >= grid * 2) enemy.goUp = true;
			else if(enemy.y < grid) enemy.goUp = false;
			enemy.y = enemy.goUp ? enemy.y - ySpeed : enemy.y + ySpeed;
			enemy.x = enemy.x;
			if(gameClock % 10 == 0 && !leftBossShoot) spawnShots.boss.one(enemy);
			return enemy;
		}
	}
};

const enemyWaves = {
	small: {
		one(){
			const step = grid * .75;
			return {
				animation: enemyAnimations.small.one,
				img: enemySmallOneImg,
				width: grid,
				height: grid,
				score: 300,
				initial: (gameWidth / 2) - (grid /2),
				enemies: [
					{count: -0.4, y: -grid - (step * 7)},
					{count: -0.2, y: -grid - (step * 6)},
					{count: 0, y: -grid - (step * 5)},
					{count: 0.2, y: -grid - (step * 4)},
					{count: 0.4, y: -grid - (step * 3)},
					{count: 0.6, y: -grid - (step * 2)},
					{count: 0.8, y: -grid - step},
					{count: 1, y: -grid}
				]
			}
		},
		two(){
			return {
				animation: enemyAnimations.small.two,
				width: grid,
				height: grid,
				score: 500,
				enemies: [
					{x: grid, y: -grid, hits: 2},
					{x: grid * 5, y: -grid * 3, hits: 2},
					{x: gameWidth - (grid * 2), y: -grid, hits: 2},
					{x: gameWidth - (grid * 6), y: -grid * 3, hits: 2},
				]
			}
		},
		three(){
			return {
				animation: enemyAnimations.small.three,
				width: grid,
				// img: enemySmallFourImg,
				height: grid,
				score: 300,
				enemies: [
					{x: grid * Math.floor(Math.random() * 15), y: -grid * Math.floor(Math.random() * 10)},
					{x: grid * Math.floor(Math.random() * 15), y: -grid * Math.floor(Math.random() * 10)},
					{x: grid * Math.floor(Math.random() * 15), y: -grid * Math.floor(Math.random() * 10)},
					{x: grid * Math.floor(Math.random() * 15), y: -grid * Math.floor(Math.random() * 10)},
					{x: grid * Math.floor(Math.random() * 15), y: -grid * Math.floor(Math.random() * 10)},
					{x: grid * Math.floor(Math.random() * 15), y: -grid * Math.floor(Math.random() * 10)},
				]
			}
		},
		four(){
			const step = grid * 1.5;
			return {
				animation: enemyAnimations.small.four,
				img: enemySmallTwoImg,
				width: grid,
				height: grid,
				score: 300,
				enemies: [
					{x: grid * 2, y: -grid - (step * 4), direction: 'downRight'},
					{x: grid * 2, y: -grid - (step * 3), direction: 'downRight'},
					{x: grid * 2, y: -grid - (step * 2), direction: 'downRight'},
					{x: grid * 2, y: -grid - step, direction: 'downRight'},
					{x: grid * 2, y: -grid, direction: 'downRight'},
					{x: gameWidth - (grid * 3), y: -grid - (step * 4), direction: 'downLeft'},
					{x: gameWidth - (grid * 3), y: -grid - (step * 3), direction: 'downLeft'},
					{x: gameWidth - (grid * 3), y: -grid - (step * 2), direction: 'downLeft'},
					{x: gameWidth - (grid * 3), y: -grid - step, direction: 'downLeft'},
					{x: gameWidth - (grid * 3), y: -grid, direction: 'downLeft'},
				]
			}
		},
		five(){
			const step = grid + (grid / 4), startX = gameWidth - (grid * 4);
			return {
				animation: enemyAnimations.small.five,
				img: enemySmallTwoImg,
				width: grid,
				height: grid,
				score: 300,
				enemies: [
					{x: startX, y: -grid},
					{x: startX, y: -grid - step},
					{x: startX, y: -grid - (step * 2)},
					{x: startX, y: -grid - (step * 3)},
					{x: startX, y: -grid - (step * 4)},
					{x: startX, y: -grid - (step * 5)},
					{x: startX, y: -grid - (step * 6)},
					{x: startX, y: -grid - (step * 7)},
					{x: startX, y: -grid - (step * 8)},
				]
			}
		},
		six(){
			return {
				animation: enemyAnimations.small.six,
				width: grid,
				height: grid,
				score: 300,
				enemies: [
					{x: grid, y: -grid, limit: (gameHeight / 3) * 2},
					{x: gameWidth - (grid * 2), y: -grid, limit: (gameHeight / 3) * 2},
					{x: grid * 2, y: -grid * 5, limit: (gameHeight / 3)},
					{x: gameWidth - (grid * 3), y: -grid * 5, limit: (gameHeight / 3)},
					{x: (gameWidth / 2) - (grid / 2), y: -grid * 8, limit: (gameHeight / 3)}
				]
			}
		},
		seven(){
			return {
				animation: enemyAnimations.small.seven,
				width: grid,
				height: grid,
				img: enemySmallOneImg,
				score: 300,
				enemies: [
					{x: grid * 4, y: -grid * 8, direction: 'right'},
					{x: gameWidth - (grid * 5), y: -grid * 8, direction: 'left'},
					{x: grid, y: -grid * 4, direction: 'right'},
					{x: gameWidth - (grid * 2), y: -grid * 4, direction: 'left'},
					{x: grid * 4, y: -grid, direction: 'right'},
					{x: gameWidth - (grid * 5), y: -grid, direction: 'left'},
				]
			}
		},
		eight(){
			const step = grid * 1.25;
			return {
				animation: enemyAnimations.small.eight,
				width: grid,
				height: grid,
				img: enemySmallTwoImg,
				fromBottom: true,
				score: 300,
				enemies: [
					{x: grid * 2, y: gameHeight + (step * 4), direction: 'downRight'},
					{x: grid * 2, y: gameHeight + (step * 3), direction: 'downRight'},
					{x: grid * 2, y: gameHeight + (step * 2), direction: 'downRight'},
					{x: grid * 2, y: gameHeight + step, direction: 'downRight'},
					{x: grid * 2, y: gameHeight, direction: 'downRight'},
					{x: gameWidth - (grid * 3), y: gameHeight + (step * 4), direction: 'downLeft'},
					{x: gameWidth - (grid * 3), y: gameHeight + (step * 3), direction: 'downLeft'},
					{x: gameWidth - (grid * 3), y: gameHeight + (step * 2), direction: 'downLeft'},
					{x: gameWidth - (grid * 3), y: gameHeight + step, direction: 'downLeft'},
					{x: gameWidth - (grid * 3), y: gameHeight, direction: 'downLeft'},
				]
			}
		},
		nine(){
			const step = grid + (grid / 4), startX = grid * 2;
			return {
				animation: enemyAnimations.small.nine,
				img: enemySmallTwoImg,
				width: grid,
				height: grid,
				score: 300,
				enemies: [
					{x: startX, y: -grid},
					{x: startX, y: -grid - step},
					{x: startX, y: -grid - (step * 2)},
					{x: startX, y: -grid - (step * 3)},
					{x: startX, y: -grid - (step * 4)},
					{x: startX, y: -grid - (step * 5)},
					{x: startX, y: -grid - (step * 6)},
					{x: startX, y: -grid - (step * 7)},
					{x: startX, y: -grid - (step * 8)},
				]
			}
		}
	},
	medium: {
		one(){
			return {
				animation: enemyAnimations.medium.one,
				img: enemyMediumOneImg,
				score: 2000,
				height: grid * 2,
				width: grid * 2,
				onlyDestroysPlayer: true,
				fromBottom: true,
				enemies: [
					{x: grid * 4, y: grid * -2, hits: 15},
				]
			}
		},
		two(){
			return {
				animation: enemyAnimations.medium.two,
				img: enemyMediumOneImg,
				score: 2000,
				height: grid * 2,
				width: grid * 2,
				onlyDestroysPlayer: true,
				enemies: [
					{x: gameWidth + grid, y: 0, hits: 6, initialY: (gameHeight / 3) - grid, angle: 4.7, radiusMulti: 7.5, rotateSpeed: 0.022},
					{x: gameWidth + grid, y: 0, hits: 6, initialY: (gameHeight / 3) + grid, angle: 5, radiusMulti: 6.5, rotateSpeed: 0.026}
				]
			}
		},
		three(isRight){
			var xPos = isRight ? gameWidth - (grid * 4) : grid * 2;
			return {
				animation: enemyAnimations.medium.three,
				img: enemyMediumOneImg,
				score: 2000,
				height: grid * 2,
				width: grid * 2,
				onlyDestroysPlayer: true,
				fromBottom: true,
				enemies: [
					{x: xPos, hits: 10, y: grid * -2}
				]
			}
		},
		four(){
			return {
				animation: enemyAnimations.medium.four,
				img: enemyMediumOneImg,
				score: 2000,
				height: grid * 2,
				width: grid * 2,
				onlyDestroysPlayer: true,
				enemies: [
					{x: grid * -1, y: 0, hits: 6, initialY: (gameHeight / 3), angle: 4.7, radiusMulti: 7.5, rotateSpeed: 0.022},
					{x: gameWidth + grid, y: 0, hits: 6, initialY: (gameHeight / 3), angle: 4.7, radiusMulti: 7.5, rotateSpeed: 0.022, goesRight: true}
				]
			}
		},
	},
	boss: {
		one(){
			return {
				isBoss: true,
				animations: [enemyAnimations.boss.one, enemyAnimations.boss.two],
				imgs: [bossOneImg, bossTwoImg],
				onlyDestroysPlayer: true,
				score: 12000,
				heights: [grid * 3.5, grid * 3.5],
				widths: [grid * 3.5, grid * 3.5],
				enemies: [
					{x: grid * 2, y: grid, hits: 50},
					{x: gameWidth - (grid * 2) - (grid * 3.5), y: grid, hits: 50}
				]
			}
		}
	}
};

const waves = [
	enemyWaves.small.one(),
	enemyWaves.small.one(),
	enemyWaves.small.two(),
	enemyWaves.small.two(),
	enemyWaves.small.three(),
	enemyWaves.small.three(),
	enemyWaves.small.four(),
	enemyWaves.small.five(),
	enemyWaves.small.six(),
	enemyWaves.small.six(),
	enemyWaves.medium.one(),
	enemyWaves.medium.two(),
	enemyWaves.small.seven(),
	enemyWaves.small.seven(),
	enemyWaves.small.three(),
	enemyWaves.small.three(),
	enemyWaves.small.eight(),
	enemyWaves.medium.three(),
	enemyWaves.medium.three(true),
	enemyWaves.small.seven(),
	enemyWaves.small.seven(),
	enemyWaves.medium.four(),
	enemyWaves.small.nine(),
	enemyWaves.boss.one()
];

let waveClock = 0;
const waveLimit = 40;

enemiesLoop = function(){
	//  && gameClock >= 120
	if(waves.length && gameClock >= 120 && waveClock == 0){
		currentWave = waves[0];
		const draw = function(enemy, i){
			if(currentWave.isBoss){
				enemy.width = currentWave.widths[i];
				enemy.height = currentWave.heights[i];
			} else {
				enemy.width = currentWave.width;
				enemy.height = currentWave.height;
			}
			if(currentWave.img) enemy.img = currentWave.img;
			else if(currentWave.imgs) enemy.img = currentWave.imgs[i];
			if(currentWave.animation) enemy.animation = currentWave.animation;
			else if(currentWave.animations) enemy.animation = currentWave.animations[i];
			if(currentWave.initial) enemy.initial = currentWave.initial;
			enemy = enemy.animation(enemy);
			if(enemy.img){
				if(enemy.hitClock){
					context.save();
					context.drawImage(enemy.img, enemy.x, enemy.y);
					context.globalCompositeOperation = 'color-dodge';
					context.fillStyle = 'rgba(255,255,255,.5)';
					context.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
					context.restore();
					enemy.hitClock--;
				} else context.drawImage(enemy.img, enemy.x, enemy.y);
			}
			if(currentWave.fromBottom){
				if(enemy.y <= -(grid * 2) || enemy.x + enemy.width <= -(grid * 4) || enemy.x >= gameWidth + (grid * 4)) currentWave.enemies.splice(i, 1);
			} else {
				if(enemy.y <= -(grid * 10) || enemy.x + enemy.width <= -(grid * 4) || enemy.x >= gameWidth + (grid * 4) || enemy.y > gameHeight) currentWave.enemies.splice(i, 1);
			}
			if(!currentWave.enemies.length){
				waveClock = waveLimit;
				waves.shift();
			}
			const enemyCollisionEl = {x: enemy.x, y: enemy.y, width: enemy.width, height: enemy.height},
			killEnemy = function(bulletObj){
				explodeEntity(bulletObj);
				score += currentWave.score;
				currentWave.chain++;
				currentWave.enemies.splice(i, 1);
			};
			checkBulletCollision(enemyCollisionEl, function(bulletObj){
				if(enemy.hits){
					enemy.hits -= 1;
					enemy.hitClock = 2;
					if(enemy.hits == 0) killEnemy(bulletObj);
				} else killEnemy(bulletObj);
			});
			if(canGetHit){
				checkCollision({x: playerX, y: playerY, width: playerWidth, height: playerHeight}, enemyCollisionEl, function(){
					currentWave.onlyDestroysPlayer ? getHit(currentWave.enemies, i, true) : getHit(currentWave.enemies, i);
				});
			}
		};
		if(currentWave.enemies.length) currentWave.enemies.forEach(draw);
		else {
			waveClock = waveLimit;
			waves.shift();
		}
	} else if(waveClock > 0) waveClock--;
	if(gameClock % 256 == 0) leftBossShoot = leftBossShoot ? false : true;
};
const powerupImg = new Image();
powerupImg.src = 'img/powerup.png';

let powerups = [], powerupBonusCount = 1;

const powerupLoop = function(){
	const draw = function(){
		const animatePowerups = function(){
			powerups.forEach(function(powerupObj, i){

				if(!powerupObj.width) powerupObj.width = grid;



				// const increase = 90 / 180 * Math.PI / (grid * 1.5),
				// 	offsetNum = powerupObj.initial >= gameWidth / 2 ? 0.25 : -0.25;
				// powerups[i].x = (powerupObj.x - Math.sin(powerupObj.count) * (grid * offsetNum));
				// powerups[i].count += increase;
				// context.drawImage(powerupImg, powerupObj.x, powerupObj.y);
				// powerups[i].y += 0.5;



				powerupObj.y += 0.67;
				const increase = 90 / 180 * Math.PI / (grid * 1.75);
				powerupObj.x = powerupObj.initial - Math.sin(powerupObj.count) * (grid * 6.5);
				context.drawImage(powerupImg, powerupObj.x, powerupObj.y);
				powerupObj.count += increase;


				if(powerupObj.y >= gameHeight) powerups.splice(i, 1);
				checkPowerupCollision(powerupObj, i);

			});
		},
		checkPowerupCollision = function(powerupObj, i){
			const powerupEl = {x: powerupObj.x, y: powerupObj.y, width: grid, height: grid}, playerEl = {x: playerX, y: playerY, width: grid, height: grid};
			checkCollision(powerupEl, playerEl, function(powerupEl, playerEl){
				powerups.splice(i, 1);
				currentPowerup < 4 ? currentPowerup++ : powerupBonus();
			});
		};
		animatePowerups();
	};
	if(gameClock < (outroTime / 3) && gameClock % (fps * 8) == 0) spawnPowerup();
	if(gameClock >= (outroTime / 3) && gameClock < (outroTime - (fps * 6)) && gameClock % (fps * 16) == 0) spawnPowerup();
	if(powerups.length) draw();
},

spawnPowerup = function(){
	powerups.push({x: grid * 11, y: -grid, initial: (gameWidth / 2) - (grid / 2), count: 0});
}, powerupBonus = function(){
	score += powerupBonusCount * 1000;
	fullscreenMessageTime = 0;
	currentFullscreenMessage = 'bonus: ' + (powerupBonusCount * 1000);
	powerupBonusCount++;
};
const playerSpeed = 3.5, playerWidth = grid, playerHeight = grid * 1.5;
let movingUp = false, movingDown = false, movingLeft = false, movingRight = false, shot = false, player, playerIsHidden = false, playerX = (gameWidth / 2) - (playerWidth / 2), playerY = gameHeight - (playerHeight + grid);

const setupPlayer = () => {
	const setupKeyboard = () => {
		document.addEventListener('keydown', playerKeysDown);
		document.addEventListener('keyup', playerKeysUp);
	}, buildPlayer = () => {
		player = new Image();
	};
	setupKeyboard();
	buildPlayer();
},

playerKeysDown = (e) => {
	switch(e.which){
		case 38: movingUp = true; break;
		case 40: movingDown = true; break;
		case 37: movingLeft = true; break;
		case 39: movingRight = true; break;
		case 90: shot = true; break;
		case 27: mainWindow.reload(); break;
	};
},

playerKeysUp = (e) => {
	switch(e.which){
		case 38: movingUp = false; break;
		case 40: movingDown = false; break;
		case 37: movingLeft = false; break;
		case 39: movingRight = false; break;
		case 90: shot = false; break;
	};
},

playerLoop = () => {
	const update = () => {
		const updateGamepad = () => {
			if(navigator.getGamepads()[0]){
				gamepad = navigator.getGamepads()[0];
				if(gamepad.axes[9]){
					const hatSwitch = gamepad.axes[9].toFixed(1);
					movingUp = hatSwitch == '-1.0' || hatSwitch == '1.0' || hatSwitch == '-0.7' ? true : false;
					movingDown = hatSwitch == '0.1' || hatSwitch == '-0.1' || hatSwitch == '0.4' ? true : false;
					movingLeft = hatSwitch == '0.7' || hatSwitch == '1.0' || hatSwitch == '0.4' ? true : false;
					movingRight = hatSwitch == '-0.4' || hatSwitch == '-0.1' || hatSwitch == '-0.7' ? true : false; 
				} else {
					movingUp = gamepad.axes[1] < analogThresh * -1 ? true : false;
					movingDown = gamepad.axes[1] > analogThresh ? true : false;
					movingLeft = gamepad.axes[0] < analogThresh * -1 ? true : false;
					movingRight = gamepad.axes[0] > analogThresh ? true : false;
				}
				shot = gamepad.buttons[0].pressed || gamepad.buttons[1].pressed || gamepad.buttons[3].pressed || gamepad.buttons[2].pressed ? true : false;
				if(gamepad.buttons[8].pressed) mainWindow.reload();
			}
		},
		updateKeyboard = () => {
			if(movingRight) playerX += playerSpeed;
			else if(movingLeft) playerX -= playerSpeed;
			if(movingUp) playerY -= playerSpeed;
			else if(movingDown) playerY += playerSpeed;
			if(playerX <= 0) playerX = 0;
			else if(playerX + playerWidth >= gameWidth) playerX = gameWidth - playerWidth;
			if(playerY <= 0) playerY = 0;
			else if(playerY + playerHeight >= gameHeight) playerY = gameHeight - playerHeight;
		};
		updateGamepad();
		updateKeyboard();
	},
	draw = () => {
		if(!isGameOver){
			if(!canGetHit){
				if(gameClock % 10 == 0) player.src = 'img/playerblank.png';
				else if(gameClock % 10 == 5) player.src = 'img/player.png';
			} else if(player.src != 'img/player.png') {
				player.src = 'img/player.png';
			}
			let offset = 0;
			if(movingLeft) offset = grid;
			else if(movingRight) offset = grid * 2;
			context.drawImage(player, offset, 0, grid, grid * 1.5, playerX, playerY, grid, grid * 1.5);
		}
	};
	update();
	draw();
};
let enemyShots = {
	small: {seven: []},
	medium: {one: [], two: []},
	boss: {one: [], two: []}
};

const missileOneImg = new Image(), missileTwoImg = new Image(), blueBulletImg = new Image();
missileOneImg.src = 'img/missileone.png';
missileTwoImg.src = 'img/missiletwo.png';
blueBulletImg.src = 'img/bluebullet.png';

let bossAngle = 0, bossRight = false;
const bossDiff = 1.25, bossRem = 0.005;

const spawnShots = {
	small: {
		seven(enemy){
			enemyShots.small.seven.push({x: enemy.x + (enemy.width / 2) - 3, y: enemy.y + ((enemy.height / 4) * 3), width: 6, height: 6});
		}
	}, medium: {
		one(enemy){
			enemyShots.medium.one.push({x: enemy.x + (enemy.width / 2) - 3, y: enemy.y + ((enemy.height / 4) * 3), width: 6, height: 6});
		}, two(enemy){
			enemyShots.medium.two.push({x: enemy.x + (enemy.width / 2) - 3, y: enemy.y + ((enemy.height / 4) * 3), width: 12, height: grid});
		}
	}, boss: {
		one(enemy){
			enemyShots.boss.one.push({x: enemy.x + (enemy.width / 2) - 4, y: enemy.y + ((enemy.height / 4) * 3), width: 12, height: grid});
		}, two(enemy){
			enemyShots.boss.one.push({x: enemy.x, y: enemy.y + enemy.y + ((enemy.height / 4) * 3), width: 12, height: grid});
		}
	}
},

shotAnimations = {
	small: {
		seven: function(){
			const vel = 2;
			enemyShots.small.seven.forEach(function(shotObj, i){
				if(!shotObj.dAngle) shotObj.dAngle = Math.atan2(playerY - shotObj.y, (playerX + (playerWidth / 2) - 3) - shotObj.x);
				shotObj.x += vel * Math.cos(shotObj.dAngle);
				shotObj.y += (vel) * Math.sin(shotObj.dAngle);
				context.drawImage(blueBulletImg, shotObj.x, shotObj.y);
				if(canGetHit) checkEnemyShotCollision(shotObj, i, enemyShots.small.seven);
				if(shotObj.y >= gameHeight) enemyShots.small.seven.splice(i, 1);
			});
		}
	}, medium: {
		one(){
			const vel = 2;
			enemyShots.medium.one.forEach((shotObj, i) => {
				if(!shotObj.dAngle) shotObj.dAngle = Math.atan2(playerY - shotObj.y, (playerX + (playerWidth / 2) - 3) - shotObj.x);
				shotObj.x += vel * Math.cos(shotObj.dAngle);
				shotObj.y += (vel) * Math.sin(shotObj.dAngle);
				context.drawImage(blueBulletImg, shotObj.x, shotObj.y);
				if(canGetHit) checkEnemyShotCollision(shotObj, i, enemyShots.medium.one);
				if(shotObj.y >= gameHeight) enemyShots.medium.one.splice(i, 1);
			});
		}, two(){
			enemyShots.medium.two.forEach((shotObj, i) => {
				shotObj.y += 1.5;
				context.drawImage(missileOneImg, shotObj.x, shotObj.y);
				if(canGetHit) checkEnemyShotCollision(shotObj, i, enemyShots.medium.one);
				checkEnemyPopcorn(shotObj, i, enemyShots.medium.two);
				if(shotObj.y >= gameHeight) enemyShots.medium.two.splice(i, 1);
			});
		}
	}, boss: {
		one(){
			enemyShots.boss.one.forEach((shotObj, i) => {
				if(bossRight){
					if(bossAngle >= bossDiff) bossRight = false;
					bossAngle = bossAngle + bossRem;
				} else {
					if(bossAngle <= -bossDiff) bossRight = true; 
					bossAngle = bossAngle - bossRem;
				}
				if(!shotObj.init) shotObj.init = bossAngle;
				shotObj.x += shotObj.init;
				shotObj.y += 1.75;
				context.drawImage(missileOneImg, shotObj.x, shotObj.y);
				if(canGetHit) checkEnemyShotCollision(shotObj, i, enemyShots.boss.one);
				checkEnemyPopcorn(shotObj, i, enemyShots.boss.one);
				if(shotObj.y >= gameHeight) enemyShots.boss.one.splice(i, 1);
			});
		}, two(){

		}
	}
},

enemyShootingLoop = function(){
	var draw = function(){
		if(enemyShots.small.seven.length) shotAnimations.small.seven();
		if(enemyShots.medium.one.length) shotAnimations.medium.one();
		if(enemyShots.medium.two.length) shotAnimations.medium.two();
		if(enemyShots.boss.one.length) shotAnimations.boss.one();
		if(enemyShots.boss.two.length) shotAnimations.boss.two();
	};
	draw();
},

checkEnemyShotCollision = function(shotObj, i, arr){
	checkCollision(shotObj, {x: playerX, y: playerY, width: grid, height: grid}, function(){
		arr.splice(i, 1);
		getHit(arr, i);
	});
},

checkEnemyPopcorn = function(shotObj, i, arr){
	checkBulletCollision(shotObj, function(){
		explodeEntity(shotObj);
		arr.splice(i, 1);
		score += 20;
	});
};
let shots = {one: [], two: [], twoBottom: [], three: [], threeBottom: [], threeLeft: [], threeRight: [], four: [], fourTopLeft: [], fourTopRight: [], fourBottomLeft: [], fourBottomRight: []}, canShoot = true, currentPowerup = 1;
const shotSpeed = 10, shotClock = 6, shotWidth = grid / 2, shotHeight = grid / 2,
	bulletOneImg = new Image(), bulletTwoImg = new Image(), bulletThreeImg = new Image(), bulletThreeLeftImg = new Image(), bulletThreeRightImg = new Image();
bulletOneImg.src = 'img/playerbullet.png';
bulletTwoImg.src = 'img/playerbullettwo.png';
bulletThreeImg.src = 'img/playerbulletthree.png';
bulletThreeLeftImg.src = 'img/playerbulletthreeleft.png';
bulletThreeRightImg.src = 'img/playerbulletthreeright.png';

const shootingLoop = function(){
	const update = function(){
		if(shot && (gameClock % shotClock == 0)){
			const shotX = playerX + (playerWidth / 2) - (shotWidth / 2);
			const shotObj = {x: shotX, y: playerY - ((grid / 3) * 2)};
			switch(currentPowerup){
				case 1: shots.one.push(shotObj); break;
				case 2:
					shots.two.push(shotObj);
					shots.twoBottom.push({x: shotX + (grid / 8), y: playerY + (grid * 1.5)});
					break;
				case 3:
					shots.three.push({x: shotX + (grid / 8), y: playerY - ((grid / 3) * 2)});
					shots.threeBottom.push({x: shotX + (grid / 8), y: playerY + (grid * 1.5)});
					shots.threeLeft.push({x: shotX - grid, y: playerY - (grid / 4)});
					shots.threeRight.push({x: shotX + grid, y: playerY - (grid / 4)});
					break;
				case 4:
					shots.four.push(shotObj);
					shots.fourTopLeft.push({x: shotX - grid, y: playerY - (grid / 4)});
					shots.fourTopRight.push({x: shotX + grid, y: playerY - (grid / 4)});
					shots.fourBottomLeft.push({x: shotX - grid, y: playerY + (grid * 1.25)});
					shots.fourBottomRight.push({x: shotX + grid, y: playerY + (grid * 1.25)});
					break;
			};
		}
	};
	const draw = function(){
		let typeCount = 0;
		for(let i in shots){
			if(shots[i].length){
				shots[i].forEach(function(shotItem, j){
					shootBullet(shotItem, j, typeCount);
				});
			}
			typeCount++;
		};
	};
	update();
	draw();
},

checkBulletBounds = function(shotItem){
	return (shotItem.y + shotHeight >= 0 && shotItem.y <= gameHeight && shotItem.x + shotWidth >= 0 && shotItem.x <= gameWidth) ? true : false;
},

shootBullet = function(shotItem, i, type){
	switch(type){
		case 0: shootBulletOne(shotItem, i); break;
		case 1: shootBulletTwo(shotItem, i); break;
		case 2: shootBulletTwoBottom(shotItem, i); break;
		case 3: shootBulletThree(shotItem, i); break;
		case 4: shootBulletThreeBottom(shotItem, i); break;
		case 5: shootBulletThreeLeft(shotItem, i); break;
		case 6: shootBulletThreeRight(shotItem, i); break;
		case 7: shootBulletFour(shotItem, i); break;
		case 8: shootBulletFourTopLeft(shotItem, i); break;
		case 9: shootBulletFourTopRight(shotItem, i); break;
		case 10: shootBulletFourBottomLeft(shotItem, i); break;
		case 11: shootBulletFourBottomRight(shotItem, i); break;
	};
},

shootBulletOne = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletOneImg, shotItem.x, shotItem.y);
		shots.one[i].y = shotItem.y -= shotSpeed;
	} else {
		shots.one.splice(i, 1)
	}
},

shootBulletTwo = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletOneImg, shotItem.x, shotItem.y);
		shots.two[i].y = shotItem.y -= shotSpeed;
	} else {
		shots.two.splice(i, 1)
	}
},

shootBulletTwoBottom = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletTwoImg, shotItem.x, shotItem.y);
		shots.twoBottom[i].y = shotItem.y += shotSpeed;
	} else {
		shots.twoBottom.splice(i, 1)
	}
},

shootBulletThree = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletThreeImg, shotItem.x, shotItem.y);
		shots.three[i].y = shotItem.y -= shotSpeed;
	} else {
		shots.three.splice(i, 1)
	}
},

shootBulletThreeBottom = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletTwoImg, shotItem.x, shotItem.y);
		shots.threeBottom[i].y = shotItem.y += shotSpeed;
	} else {
		shots.threeBottom.splice(i, 1)
	}
},

shootBulletThreeLeft = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletThreeLeftImg, shotItem.x, shotItem.y);
		shots.threeLeft[i].y = shotItem.y -= shotSpeed;
		shots.threeLeft[i].x = shotItem.x -= shotSpeed;
	} else {
		shots.threeLeft.splice(i, 1)
	}
},

shootBulletThreeRight = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletThreeRightImg, shotItem.x, shotItem.y);
		shots.threeRight[i].y = shotItem.y -= shotSpeed;
		shots.threeRight[i].x = shotItem.x += shotSpeed;
	} else {
		shots.threeRight.splice(i, 1)
	}
},

shootBulletFour = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletOneImg, shotItem.x, shotItem.y);
		shots.four[i].y = shotItem.y -= shotSpeed;
	} else {
		shots.four.splice(i, 1)
	}
},

shootBulletFourTopLeft = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletThreeLeftImg, shotItem.x, shotItem.y);
		shots.fourTopLeft[i].y = shotItem.y -= shotSpeed;
		shots.fourTopLeft[i].x = shotItem.x -= shotSpeed;
	} else {
		shots.fourTopLeft.splice(i, 1)
	}
},

shootBulletFourTopRight = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletThreeRightImg, shotItem.x, shotItem.y);
		shots.fourTopRight[i].y = shotItem.y -= shotSpeed;
		shots.fourTopRight[i].x = shotItem.x += shotSpeed;
	} else {
		shots.fourTopRight.splice(i, 1)
	}
},

shootBulletFourBottomLeft = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletThreeRightImg, shotItem.x, shotItem.y);
		shots.fourBottomLeft[i].y = shotItem.y += shotSpeed;
		shots.fourBottomLeft[i].x = shotItem.x -= shotSpeed;
	} else {
		shots.fourBottomLeft.splice(i, 1)
	}
},

shootBulletFourBottomRight = function(shotItem, i){
	if(checkBulletBounds(shotItem)){
		context.drawImage(bulletThreeLeftImg, shotItem.x, shotItem.y);
		shots.fourBottomRight[i].y = shotItem.y += shotSpeed;
		shots.fourBottomRight[i].x = shotItem.x += shotSpeed;
	} else {
		shots.fourBottomRight.splice(i, 1)
	}
},

checkBulletCollision = function(el, callback){
	for(var group in shots){
		if(shots[group].length){
			shots[group].forEach(function(shot, i){
				var shotObj = {x: shot.x, y: shot.y, width: grid / 2, height: grid / 2};
				if(group == 'twoBottom' || group == 'three' || group == 'threeBottom') shotObj.width = grid / 4;
				checkCollision(el, shotObj, function(el, shotObj){
					shots[group].splice(i, 1);
					callback(shotObj);
				});
			});
		}
	};
};
let explosions = [];

const explodeEntity = function(entityObj, passClock){
	entityObj.time = passClock ? passClock : gameClock;
	explosions.push(entityObj);
};


const explosionAnimateTime = 1, explosionSize = grid * 2;

const explosionImg = new Image();
explosionImg.src = 'img/explosions.png';

const explosionsLoop = function(){
	const draw = function(){
		explosions.forEach(function(explosion, i){
			if(gameClock >= explosion.time + (explosionAnimateTime * 5)){
				explosions.splice(i, 1);
			} else {
				let sX = 0;
				if(gameClock >= explosion.time + explosionAnimateTime && gameClock < explosion.time + (explosionAnimateTime * 2)) sX = explosionSize;
				else if(gameClock >= explosion.time + (explosionAnimateTime * 2) && gameClock < explosion.time + (explosionAnimateTime * 3)) sX = explosionSize * 2;
				else if(gameClock >= explosion.time + (explosionAnimateTime * 3) && gameClock < explosion.time + (explosionAnimateTime * 4)) sX = explosionSize * 3;
				else if(gameClock >= explosion.time + (explosionAnimateTime * 4) && gameClock < explosion.time + (explosionAnimateTime * 5)) sX = explosionSize * 4;
				if(explosionSize > explosion.width){
					if(explosion.width == grid) explosion.x = explosion.x - (grid / 8);
					else explosion.x = explosion.x - (grid / 4);
				}
				if(explosionSize > explosion.width) explosion.y = explosion.y - (grid / 8);
				context.drawImage(explosionImg, sX, 0, explosionSize, explosionSize, explosion.x, explosion.y, explosionSize, explosionSize);
			}
		});
	};
	if(explosions.length) draw();
};
let score = 0, highScore = 0, fullscreenMessageTime = 0, currentFullscreenMessage = 'score attack: 2 min', initialTime = new Date(), canTime = true, livesLeft = 4, isFinished = false, isDead = false,
	hitClock = 0, scoreSaved = false;

const setupHighScore = function(){
	if(savedData.highScore) highScore = savedData.highScore;
	else storage.set('savedData', savedData);
},

hudLoop = function(){

	const drawScore = function(){
		let tempScore = String(score);
		const addZero = function(input){
			return input.length < 7 ? addZero('0' + input) : input;
		};
		tempScore = addZero(tempScore);
		drawString('score ' + tempScore, grid / 4, grid / 4);
	},

	drawHighScore = function(){
		if(score > highScore) highScore = score;
		let tempScore = String(highScore);
		const addZero = function(input){
			return input.length < 7 ? addZero('0' + input) : input;
		};
		tempScore = addZero(tempScore);
		drawString('high ' + tempScore, (gameWidth - (grid / 4)) - ((grid / 2) * 12), grid / 4);
	},

	drawTime = function(){
		if(canTime){
			let timeString = '';
			const secondsLeft = 120 - (gameClock / fps),
			buildTimeString = function(){
				var tempMinutes = secondsLeft > 60 ? '1' : '0';
				var tempSeconds = String(secondsLeft);
				if(tempSeconds.indexOf('.') > -1) tempSeconds = tempSeconds.substring(0, tempSeconds.indexOf('.'));
				if(tempSeconds > 59) tempSeconds = tempSeconds - 60;
				tempSeconds = String(tempSeconds);
				if(tempSeconds.length < 2) tempSeconds = '0' + tempSeconds;
				var tempMilliseconds = String(secondsLeft);
				tempMilliseconds = tempMilliseconds.substring(tempMilliseconds.indexOf('.') + 1);
				tempMilliseconds = tempMilliseconds.substring(0, 2);
				if(tempMilliseconds.length < 2) tempMilliseconds = '0' + tempMilliseconds;
				return tempMinutes + ':' + tempSeconds + ':' + tempMilliseconds;
			};
			if(secondsLeft == 120) timeString = '2:00:00';
			else if(secondsLeft < 120 && secondsLeft > 0) timeString = buildTimeString();
			else {
				document.removeEventListener('keydown', playerKeysDown);
				document.removeEventListener('keyup', playerKeysUp);
				document.addEventListener('playerReloadOnly', playerKeysUp);
				canTime = false;
				isFinished = true;
			}
			drawString('time ' + timeString, grid / 4, (grid / 4) * 3);
		} else {
			drawString('time ' + '0:00:00', grid / 4, (grid / 4) * 3);
			isGameOver = true;
			shot = false;
			canGetHit = false;
			playerX = (gameWidth / 2) - (grid / 2);
			playerY = gameHeight * 2;
			if(isFinished) drawFullscreenMessageGameOver('time over');
			else if(isDead) drawFullscreenMessageGameOver('game over');
			if(!scoreSaved) saveHighScore();
		}
	},

	drawLives = function(){
		const stringNum = livesLeft > 0 ? livesLeft - 1 : livesLeft;
		drawString('left:' + String(stringNum), gameWidth - (grid * 3) - (grid / 4), gameHeight - (grid / 2) - (grid / 4));
		if(livesLeft == 0){
			document.removeEventListener('keydown', playerKeysDown);
			document.removeEventListener('keyup', playerKeysUp);
			document.addEventListener('playerReloadOnly', playerKeysUp);
			canTime = false;
			isDead = true;
		}
		if(hitClock > 0) hitClock--;
		else if(!canGetHit) canGetHit = true;
	},

	drawFullscreenMessage = function(){
		drawString(currentFullscreenMessage, (gameWidth / 2) - (currentFullscreenMessage.length * (grid / 4)), (gameHeight / 2) - (grid / 4), true);
		fullscreenMessageTime++;
	},

	drawFullscreenMessageGameOver = function(message){
		if(gameClock == 8200) mainWindow.reload();
		const baseYPos = (gameHeight / 2) - (grid / 4);
		const firstString = message, secondString = 'your score ' + score,
			thirdString = (score == highScore) ? 'new high score ' + score : '';
		if(thirdString == ''){
			drawString(firstString, (gameWidth / 2) - (firstString.length * (grid / 4)), baseYPos - (grid / 2), true);
			drawString(secondString, (gameWidth / 2) - (secondString.length * (grid / 4)), baseYPos + (grid / 2), true);
		} else {
			drawString(firstString, (gameWidth / 2) - (firstString.length * (grid / 4)), baseYPos - grid, true);
			drawString(secondString, (gameWidth / 2) - (secondString.length * (grid / 4)), baseYPos, true);
			drawString(thirdString, (gameWidth / 2) - (thirdString.length * (grid / 4)), baseYPos + grid, true);
		}
	};

	drawScore();
	drawHighScore();
	drawTime();
	drawLives();
	if(fullscreenMessageTime < fps * 2.5) drawFullscreenMessage();
}, 

timeString = function(timeInput){
	const buildTimeString = function(){
		let timeChars = '';
		timeInput.split('').forEach(function(timeNum){
			if(timeNum == ':'){
				timeChars += '<fontchar class="colon"></fontchar>'
			}	else {
				timeChars += '<fontchar class="num_' + timeNum + '"></fontchar>'
			}	
		});
		return timeChars;
	};
	var output = '<fontchar class="t"></fontchar>\
		<fontchar class="i"></fontchar>\
		<fontchar class="m"></fontchar>\
		<fontchar class="e"></fontchar>\
		<fontchar class="space"></fontchar>' +
		buildTimeString();
	return output;
},

getHit = function(enemyArr, i, destroysOnlyPlayer){
	if(livesLeft > 0) livesLeft -= 1;
	explodeEntity({x: playerX, y: playerY, width: playerWidth, height: playerHeight});
	playerX = (gameWidth / 2) - (playerWidth / 2), playerY = gameHeight - ((grid * 2.75) + grid);
	currentPowerup = 1;
	canGetHit = false;
	hitClock = fps * 2;
	if(!destroysOnlyPlayer) enemyArr.splice(i, 1);
},

saveHighScore = function(){
	scoreSaved = true;
	savedData.highScore = highScore;
	storage.set('savedData', savedData);
};